-- TRAINERS
CREATE TABLE trainers
(
    id               BIGSERIAL PRIMARY KEY,
    user_id          BIGINT REFERENCES users (id) ON DELETE SET NULL,
    name             TEXT   NOT NULL, -- remove if duplicating securityUser name is not needed
    daily_hour_limit INT
);

-- SLOTS
CREATE TABLE slots
(
    id               BIGSERIAL PRIMARY KEY,
    trainer_id       BIGINT      NOT NULL REFERENCES trainers (id) ON DELETE CASCADE,
    start_time       TIMESTAMPTZ NOT NULL,
    duration_minutes INT         NOT NULL CHECK (duration_minutes > 0),
    capacity         INT         NOT NULL CHECK (capacity > 0),
    type             TEXT        NOT NULL, -- or ENUM
    canceled         BOOLEAN     NOT NULL DEFAULT FALSE,
    created_by       BIGINT      NOT NULL REFERENCES users (id),
    created_at       BIGSERIAL          DEFAULT
);

-- BOOKINGS
CREATE TABLE bookings
(
    id                 BIGSERIAL PRIMARY KEY,
    slot_id            BIGINT NOT NULL REFERENCES slots (id) ON DELETE CASCADE,
    user_id            BIGINT NOT NULL REFERENCES users (id),
    participants_count INT    NOT NULL CHECK (participants_count > 0),
    status             TEXT   NOT NULL, -- or ENUM
    created_at         BIGSERIAL DEFAULT,
    cancel_reason      TEXT
);

-- LOGS
CREATE TABLE logs
(
    id          BIGSERIAL PRIMARY KEY,
    actor_id    BIGINT REFERENCES users (id) ON DELETE SET NULL,
    action      TEXT   NOT NULL,
    entity_type TEXT   NOT NULL,
    entity_id   BIGINT NOT NULL,
    reason      TEXT,
    timestamp   BIGSERIAL DEFAULT
);
